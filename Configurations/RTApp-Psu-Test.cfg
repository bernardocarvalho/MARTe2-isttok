+TCPMessageProxy = {
    Class = TCPSocketMessageProxyExample
    Port = 24680

}
// echo -e "Destination=StateMachine\nFunction=GOTOSTATE2" | nc 127.0.0.1 24680
+StateMachine = {
    Class = StateMachine
    +INITIAL = {
        Class = ReferenceContainer
        +START = {
            Class = StateMachineEvent
            NextState = "STATE1"
            NextStateError = "ERROR"
            Timeout = 0
            +ChangeToState1Msg = {
                Class = Message
                Destination = TestApp
                Mode = ExpectsReply
                Function = PrepareNextState
                +Parameters = {
                    Class = ConfigurationDatabase
                    param1 = State1
                }
            }
            +StartNextStateExecutionMsg = {
                Class = Message
                Destination = TestApp
                Function = StartNextStateExecution
                Mode = ExpectsReply
            }
        }
    }
    +STATE1 = {
        Class = ReferenceContainer
        +GOTOSTATE2 = {
            Class = StateMachineEvent
            NextState = "STATE2"
            NextStateError = "ERROR"
            Timeout = 0
            +PrepareChangeToState2Msg = {
                Class = Message
                Destination = TestApp
                Mode = ExpectsReply
                Function = PrepareNextState
                +Parameters = {
                    Class = ConfigurationDatabase
                    param1 = State2
                }
            }
            +StopCurrentStateExecutionMsg = {
                Class = Message
                Destination = TestApp
                Function = StopCurrentStateExecution
                Mode = ExpectsReply
            }
            +StartNextStateExecutionMsg = {
                Class = Message
                Destination = TestApp
                Function = StartNextStateExecution
                Mode = ExpectsReply
            }
            +TriggerPSUMsg = {
              Class = Message
              Destination = "TestApp.Data.UartOutDS"
              Function = GoWaitTrigger
              Mode = ExpectsReply
            }
        }
        +ERROR = {
            Class = StateMachineEvent
            NextState = "ERROR"
            NextStateError = "ERROR"
        }
    }
    +STATE2 = {
        Class = ReferenceContainer
        +GOTOSTATE3 = {
            Class = StateMachineEvent
            NextState = "STATE3"
            NextStateError = "ERROR"
            Timeout = 0
            +PrepareChangeToState3Msg = {
                Class = Message
                Destination = TestApp
                Mode = ExpectsReply
                Function = PrepareNextState
                +Parameters = {
                    Class = ConfigurationDatabase
                    param1 = State3
                }
            }
            +StopCurrentStateExecutionMsg = {
                Class = Message
                Destination = TestApp
                Function = StopCurrentStateExecution
                Mode = ExpectsReply
            }
            +StartNextStateExecutionMsg = {
                Class = Message
                Destination = TestApp
                Function = StartNextStateExecution
                Mode = ExpectsReply
            }
            +TriggerPSUMsg = {
              Class = Message
              Destination = "TestApp.Data.UartOutDS"
              Function = TriggerPSU
              Mode = ExpectsReply
            }
        }
        +ERROR = {
            Class = StateMachineEvent
            NextState = "ERROR"
            NextStateError = "ERROR"
        }
    }
    +STATE3 = {
        Class = ReferenceContainer
        +GOTOSTATE1 = {
            Class = StateMachineEvent
            NextState = "STATE1"
            NextStateError = "ERROR"
            Timeout = 0
            +PrepareChangeToState1Msg = {
                Class = Message
                Destination = TestApp
                Mode = ExpectsReply
                Function = PrepareNextState
                +Parameters = {
                    Class = ConfigurationDatabase
                    param1 = State1
                }
            }
            +StopCurrentStateExecutionMsg = {
                Class = Message
                Destination = TestApp
                Function = StopCurrentStateExecution
                Mode = ExpectsReply
            }
            +StartNextStateExecutionMsg = {
                Class = Message
                Destination = TestApp
                Function = StartNextStateExecution
                Mode = ExpectsReply
            }
            +TriggerPSUMsg = {
              Class = Message
              Destination = "TestApp.Data.UartOutDS"
              Function = GoOnlineIdle
              Mode = ExpectsReply
            }
        }
        +ERROR = {
            Class = StateMachineEvent
            NextState = "ERROR"
            NextStateError = "ERROR"
        }
    }
    +ERROR = {
        Class = ReferenceContainer
        +ENTER = {
            Class = ReferenceContainer
            +StopCurrentStateExecutionMsg = {
                Class = Message
                Destination = TestApp
                Function = StopCurrentStateExecution
                Mode = ExpectsReply
            }
            +PrepareChangeToErrorMsg = {
                Class = Message
                Destination = TestApp
                Mode = ExpectsReply
                Function = PrepareNextState
                +Parameters = {
                    Class = ConfigurationDatabase
                    param1 = StateError
                }
            }
            +StartNextStateExecutionMsg = {
                Class = Message
                Destination = TestApp
                Function = StartNextStateExecution
                Mode = ExpectsReply
            }
        }
        +RESET = {
            Class = StateMachineEvent
            NextState = "STATE1"
            NextStateError = "STATE1"
            Timeout = 0
            +StopCurrentStateExecutionMsg = {
                Class = Message
                Destination = TestApp
                Function = StopCurrentStateExecution
                Mode = ExpectsReply
            }
            +PrepareChangeToState1Msg = {
                Class = Message
                Destination = TestApp
                Mode = ExpectsReply
                Function = PrepareNextState
                +Parameters = {
                    Class = ConfigurationDatabase
                    param1 = State1
                }
            }
            +StartNextStateExecutionMsg = {
                Class = Message
                Destination = TestApp
                Function = StartNextStateExecution
                Mode = ExpectsReply
            }
        }
    }
}
$TestApp = {
    Class = RealTimeApplication
    +Functions = {
        Class = ReferenceContainer
        +GAMTimer = {
            Class = IOGAM
            InputSignals = {
                Counter = {
                    DataSource = Timer
                    Type = uint32
                }
                Time = {
                    Frequency = 100
                    DataSource = Timer
                    Type = uint32
                }
            }
            OutputSignals = {
                Counter = {
                    DataSource = DDB1
                    Type = uint32
                }
                Time = {
                    DataSource = DDB1
                    Type = uint32
                }
            }
        }
        +GAMWF = {
            Class = WaveformGAM::WaveformPointsDef
            Points = {510 510   610  610 410  410 510 510}
            Times =  {0.0  2.0  2.1  2.6 2.7  3.3 3.4 6.0} // in seconds
            InputSignals = {
                Time = {
                    DataSource = "DDB1"
                    Type = uint32 
                }
            }
            OutputSignals = {
                Reference1 = {
                    DataSource = "DDB1"
                    Type = float32
                }
            }
        }
        +GAMDisplay = {
            Class = IOGAM            
            InputSignals = {
                Time = {
                    DataSource = DDB1
                    Type = uint32
                }
                Reference1 = {
                    DataSource = DDB1
                    Type = float32
                }
            }
            OutputSignals = {
                Time = {
                    DataSource = LoggerDataSource
                    Type = uint32
                }
                Reference1 = {
                    DataSource = LoggerDataSource
                    Type = float32
                }
            }
        }
        +GAMSerialOut = {
            Class = IOGAM            
            InputSignals = {
                Reference1 = {
                    DataSource = DDB1
                    Type = float32
                }
            }
            OutputSignals = {
                SerialOut = {
                  DataSource = UartOutDS
                  Type = float32
                  Trigger = 1
                }
            }
        }
        +UartInput = {
            Class = IOGAM
            InputSignals = {
                DataOK = {
                    DataSource = Esp32UartRX
                    Type = uint8
                    NumberOfElements = 1
                }
                Time = {
                    DataSource = Esp32UartRX
                    Type = uint64
                    NumberOfElements = 1
                }
                Packet = { //Actual data to read
                    DataSource = Esp32UartRX
                    Type = uint8
                    NumberOfElements = 2
                }
            }
            OutputSignals = {
                DataOK = {
                    DataSource = DDB1
                    Type = uint8
                    NumberOfElements = 1
                }
                TimeUart = {
                    DataSource = DDB1
                    Type = uint64
                    NumberOfElements = 1
                }
                Packet = {
                    DataSource = DDB1
                    Type = uint8
                    NumberOfElements = 2
                }
            }
        }
        +GAMFileWriter = {
            Class = IOGAM
            InputSignals = {
                Counter = {
                    DataSource = DDB1
                    Type = uint32
                }
                Time = {
                    DataSource = DDB1
                    Type = uint32
                }
                Reference1 = {
                    DataSource = DDB1
                    Type = float32
                }
                DataOK = {
                    DataSource = DDB1
                    Type = uint8
                    NumberOfElements = 1
                }
                TimeUart = {
                    DataSource = DDB1
                    Type = uint64
                }
                Packet = {
                    DataSource = DDB1
                    Type = uint8
                    NumberOfElements = 2
                }
            }
            OutputSignals = {
                Counter = {
                    DataSource = FileWriter_DS
                    Type = uint32
                }
                Time = {
                    DataSource = FileWriter_DS
                    Type = uint32
                }
                Reference1 = {
                    DataSource = FileWriter_DS
                    Type = float32
                }
                DataOK = {
                    DataSource = FileWriter_DS
                    Type = uint8
                }
                TimeUart = {
                    DataSource = FileWriter_DS
                    Type = uint64
                }
                Packet = {
                    DataSource = FileWriter_DS
                    Type = uint8
                    NumberOfElements = 2
                }
            }
        }
    }
    +Data = {
        Class = ReferenceContainer
        DefaultDataSource = DDB1
        +DDB1 = {
            Class = GAMDataSource
        }
        +LoggerDataSource = {
            Class = LoggerDataSource
        }
        +Timings = {
            Class = TimingDataSource
        }
        +Timer = {
            Class = LinuxTimer
            SleepNature = "Default"
            Signals = {
                Counter = {
                    Type = uint32
                }
                Time = {
                    Type = uint32
                }
            }
        }
        +UartOutDS = {
            Class = PSUCommunicator::PSUCommunicatorTX
            PortName = "/dev/ttyS0" //Name of the UART port, Mandatory
            //PortName = "/dev/ttyLoopWr" //Name of the UART port, Mandatory
            BaudRate =  921600
            //BaudRate = 115200 // 9600 10.851 Âµs  / Byte
                //115200 576000//BAUD UART rate
            Timeout = 200000 //Maximum time to wait for data
            CPUMask = 8 //Affinity of the CPU of where to read data from
            SerialTimeout = 1000
            PointOfZeroCurrent = 50.0 //5.100000e+02
            CurrentStep = 1.0 //929700e+00
            Signals = {
                SerialOut = {
                  Type = float32 //Mandatory. Only type that is supported.
                  OutputRange = 10.0 //Mandatory. The channel Module Output Range in volt.
                }
            }
        }
        +Esp32UartRX = {
            Class = UARTDataSource
                NumberOfBuffers = 500 //Number of buffer of the circular buffer
                PortName = "/dev/ttyS0" //Name of the UART port
                BaudRate = 921600 //BAUD UART rate
                Timeout = 200000 // Timeout to synchronise
                SerialTimeout = 200000 //Maximum time to wait for data

                CPUMask = 8 //Affinity of the CPU of where to read data from
                Signals = {
                    DataOK = { //Compulsory - is the data valid?
                        Type = uint8
                        NumberOfElements = 1
                    }
                    Time = {
                        Type = uint64 //Compulsory - time-stamp in nano-seconds at which the data was read.
                        NumberOfElements = 1
                    }
                    Packet = { //Actual data to read
                      Type = uint8
                      NumberOfElements = 2
                    }
                }
        }
        +FileWriter_DS = {
            Class = FileDataSource::FileWriter
            NumberOfBuffers = 10000
            CPUMask = 1 
            StackSize = 10000000
            Filename = "PsuTest.csv" 
            Overwrite = "yes" 
            FileFormat = "csv"
            CSVSeparator = "," 
            StoreOnTrigger = 0  //Compulsory. If 0 all the data in the circular buffer is continuously stored. If 1 data is stored when the Trigger signal is 1 (see below).
            Signals = {
                Counter = { 
                    Type = uint32
                }
                Time = { 
                    Type = uint32
                }
                Reference1 = {
                    Type = float32
                }
                DataOK = {
                    Type = uint8
                }
                TimeUart = {
                    Type = uint64
                }
                Packet = {
                    Type = uint8
                }
            }
        }
    }
    +States = {
        Class = ReferenceContainer
        +State1 = {
            Class = RealTimeState
            +Threads = {
                Class = ReferenceContainer
                +Thread1 = {
                    Class = RealTimeThread
                    CPUs = 0x1
                    Functions = {GAMTimer }
                }
            }
        }
        +State2 = {
            Class = RealTimeState
            +Threads = {
                Class = ReferenceContainer
                +Thread1 = {
                    Class = RealTimeThread
                    CPUs = 0x1
                    Functions = {GAMTimer GAMWF GAMSerialOut UartInput GAMFileWriter GAMDisplay}
                }
            }
        }
        +State3 = {
            Class = RealTimeState
            +Threads = {
                Class = ReferenceContainer
                +Thread1 = {
                    Class = RealTimeThread
                    CPUs = 0x1
                    Functions = {GAMTimer GAMWF GAMSerialOut UartInput GAMFileWriter }
                }
            }
        }
    }
    +Scheduler = {
        Class = GAMScheduler
        TimingDataSource = Timings
    }
}
